Este é um "Mega-Prompt" estruturado para garantir que a IA do V0 (ou qualquer LLM de engenharia de software) entenda não apenas *o que* fazer, mas *como* arquitetar a solução de forma robusta.

Como você pediu "mínimo 5 páginas de conteúdo", eu expandi cada requisito técnico em especificações detalhadas de arquitetura, tipos, gerenciamento de estado e UX.

**Instruções de Uso:**
Copie **todo** o conteúdo em inglês abaixo (que está formatado em Markdown) e cole no chat do V0. O inglês técnico garante uma precisão muito maior na geração de código complexo do que o português.

---

# Comprehensive Engineering Specification: Central63 SaaS Dashboard

**Role:** You are a Senior Frontend Architect and Product Engineer specializing in Next.js 14, Supabase, and Enterprise SaaS Interfaces.
**Task:** Refactor and implement the core logic for the "Central63" CRM dashboard application based on the provided requirements and existing codebase structure.

---

## 1. System Architecture & Tech Stack

### 1.1 Core Technologies

* **Framework:** Next.js 14 (App Router) using Server Components where applicable, but primarily Client Components for the dashboard interactivity.
* **Language:** TypeScript (Strict Mode).
* **Styling:** Tailwind CSS with `shadcn/ui` component library.
* **Icons:** Lucide React.
* **Backend/Database:** Supabase (PostgreSQL).
* **State Management:** React Hooks (`useState`, `useEffect`) and URL Search Params for maintaining filter state.
* **Feedback:** `sonner` for toast notifications.

### 1.2 Directory Structure Enforced

Ensure the generated code follows this strict structure to match the existing uploads:

```
/app
  /layout.tsx       # Global layout with ThemeProvider
  /page.tsx         # Main Dashboard Controller
  /globals.css      # Tailwind imports
/components
  /central63        # Domain-specific components
    /filters.tsx
    /lead-card.tsx
    /details-drawer.tsx
    /stat-card.tsx
    /sidebar.tsx
  /ui               # Generic shadcn components (button, input, sheet, etc.)
/lib
  /supabase.ts      # Supabase Client initialization
  /utils.ts         # CN helper
/types
  /index.ts         # Global TypeScript Interfaces

```

---

## 2. Database Schema & Data Modeling

You must treat the Supabase backend as the single source of truth. The schema consists of two "Source" tables and one "Destination" table.

### 2.1 Source Tables: `atendimento_pmw` and `atendimento_aux`

These tables represent incoming leads from two different cities (Palmas and Auxiliar). They have **identical** structures.

**Interface `Lead` (TypeScript Definition):**

```typescript
export type CityContext = 'PMW' | 'AUX';

export interface Lead {
  id: string | number;         // Primary Key
  created_at: string;
  cliente_nome: string;        // Customer Name
  cliente_telefone?: string;   // Phone (optional)
  status: string;              // Current status
  valor: number;               // Monetary value
  codigo: string;              // Unique code/SKU
  finalidade: string;          // Purpose (e.g., Sale, Rent)
  midia: string;               // Marketing Source (e.g., Instagram, Google)
  tipo: string;                // Property Type (e.g., Apartment, House)
  unidade: string;             // Unit identifier
  descricao?: string;          // Detailed description
}

```

### 2.2 Destination Table: `vendas`

This table stores leads that have been successfully converted/launched.

**Interface `Sale` (TypeScript Definition):**

```typescript
export interface Sale {
  id?: string | number;        // Generated by DB
  created_at?: string;
  codigo: string;              // Copied from Lead
  finalidade: string;          // Copied from Lead
  midia: string;               // Copied from Lead
  tipo: string;                // Copied from Lead
  unidade: string;             // Copied from Lead
  atendimento_original_id: string | number; // FK reference to the original lead
  origem_tabela: CityContext;  // 'PMW' or 'AUX' (To know where it came from)
  user_id: string;             // The ID of the user performing the action
  status_venda: string;        // Default: 'Pendente' or 'Concluido'
}

```

---

## 3. Detailed Component Specifications

### 3.1 `lib/supabase.ts`

Initialize the client safely.

```typescript
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export const supabase = createClient(supabaseUrl, supabaseKey);

```

### 3.2 Global Filter State (`components/central63/filters.tsx`)

This component is critical. It determines which database table is queried.

* **UI Elements:**
* **City Selector (Primary Control):** A `Select` component with two options:
1. `label: "Palmas (PMW)"`, `value: "PMW"`
2. `label: "Auxiliar (AUX)"`, `value: "AUX"`


* **Search Input:** Text field to filter by `cliente_nome` or `codigo`.
* **Status Filter:** Optional dropdown to filter by specific status (excluding 'No Dash').


* **Logic:**
* When the City changes, it should update the URL query param (e.g., `?city=PMW`) OR notify the parent component via a callback function.
* **Default State:** 'PMW'.



### 3.3 The Main Dashboard (`app/page.tsx`)

This is the orchestrator.

* **Data Fetching Logic:**
1. Read the `city` state (default 'PMW').
2. Select the correct table name string:
* `const tableName = city === 'PMW' ? 'atendimento_pmw' : 'atendimento_aux';`


3. **Supabase Query:**
* `SELECT * FROM {tableName}`
* `WHERE status != 'No Dash'` (CRITICAL: Do not show leads that have been removed/launched).
* `ORDER BY created_at DESC`.




* **Loading State:** Show a grid of `Skeleton` cards while fetching.
* **Empty State:** If no leads are found, display the `components/ui/empty.tsx` component.
* **Render:** Map the resulting array to `<LeadCard />` components.

### 3.4 The Lead Card (`components/central63/lead-card.tsx`)

A summary view of the lead.

* **Props:** `data: Lead`, `onOpenDetails: (lead: Lead) => void`.
* **Visuals:**
* Header: `cliente_nome` and `valor` (formatted as BRL Currency).
* Body: badges for `midia`, `tipo`, `finalidade`.
* Footer: `status` badge (color-coded).


* **Interaction:** Clicking the card (or a "Ver Detalhes" button) triggers the `onOpenDetails` callback, passing the lead data to the parent to open the Drawer.

### 3.5 The Details Drawer (`components/central63/details-drawer.tsx`)

This is where the transactional logic lives.

* **Props:**
* `isOpen: boolean`
* `onClose: () => void`
* `lead: Lead | null`
* `currentCity: CityContext`
* `onLeadUpdated: () => void` (To refresh the list after a sale).


* **UI Structure:**
* Use `Sheet` (from shadcn) or `Drawer`.
* **Header:** Customer Name & ID.
* **Content:** A structured grid displaying all details (`codigo`, `unidade`, `descricao`, `telefone`, etc.).
* **Footer Actions:**
* Button (Secondary): "Cancelar" (Close drawer).
* **Button (Primary): "Lançar Venda" (Launch Sale).** This button must use a distinct color (e.g., green or brand primary) to signify a major action.





---

## 4. The "Launch Sale" Business Logic

This is the most complex part of the request. Implement the function `handleLaunchSale` inside `details-drawer.tsx`.

**Step-by-Step Execution Flow:**

1. **Validation:** Ensure `lead` is not null.
2. **Loading State:** Set a local state `isSubmitting = true` to disable the button and show a spinner.
3. **Mock Auth:** define `const MOCK_USER_ID = "user_system_001";`
4. **Transaction (Pseudo-code logic):**
Since Supabase client doesn't support complex transactions easily without RPC, we will execute two sequential `await` operations. If the first fails, we stop.
* **Operation A (INSERT):**
```typescript
const { error: insertError } = await supabase
  .from('vendas')
  .insert({
     codigo: lead.codigo,
     finalidade: lead.finalidade,
     midia: lead.midia,
     tipo: lead.tipo,
     unidade: lead.unidade,
     atendimento_original_id: lead.id,
     origem_tabela: currentCity,
     user_id: MOCK_USER_ID,
     status_venda: 'Concluido'
  });

```


* **Operation B (UPDATE Source):**
* Determine source table based on `currentCity`.
* Update the status to hide it from the dashboard.


```typescript
const sourceTable = currentCity === 'PMW' ? 'atendimento_pmw' : 'atendimento_aux';
const { error: updateError } = await supabase
  .from(sourceTable)
  .update({ status: 'No Dash' })
  .eq('id', lead.id);

```




5. **Error Handling:**
* If `insertError` occurs: Show `toast.error("Erro ao criar venda.")`. Stop.
* If `updateError` occurs: (Ideally, we would rollback, but for now) Show `toast.warning("Venda criada, mas erro ao atualizar status do lead.")`.


6. **Success State:**
* If both succeed:
* `toast.success("Venda lançada com sucesso!");`
* Call `onLeadUpdated()` to tell the main page to re-fetch data.
* Call `onClose()` to close the drawer.




7. **Finalize:** Set `isSubmitting = false`.

---

## 5. UI/UX & Design Guidelines

### 5.1 Theme & Colors

* **Dark Mode:** The system uses a dark theme. Ensure backgrounds are `bg-background` (usually dark slate/black) and cards are `bg-card` with subtle borders.
* **Typography:** Use `Inter` or the default sans font configured in `layout.tsx`.
* **Currency Formatting:** All monetary values must be displayed in Brazilian Real format:
```typescript
new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value)

```



### 5.2 Accessibility (A11y)

* All interactive elements must have focus states (`ring-offset-background transition-colors focus-visible:outline-none...`).
* Form inputs in the filters must have associated labels.

### 5.3 Responsiveness

* **Mobile:** The `Sidebar` should collapse or become a slide-over menu. The `DetailsDrawer` should take up 100% width on mobile (SheetBottom or SheetFull).
* **Desktop:** The grid layout for cards should be:
* Mobile: 1 column
* Tablet: 2 columns
* Desktop: 3 columns
* Large Desktop: 4 columns (`grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4`).



---

## 6. Implementation Checklist for the AI

When generating the code, please output the following files in this order to ensure dependencies are met:

1. **`types/index.ts`**: The TypeScript interfaces.
2. **`lib/supabase.ts`**: The client setup.
3. **`components/central63/filters.tsx`**: The City selection logic.
4. **`components/central63/details-drawer.tsx`**: The complex launch logic.
5. **`components/central63/lead-card.tsx`**: The display component.
6. **`app/page.tsx`**: The main controller integrating everything.

**Special Instruction:** Ensure that the `Filters` component communicates the selected city back to `page.tsx` so the data fetch can change dynamically without a full page reload, utilizing `useEffect` to refetch when dependencies change.